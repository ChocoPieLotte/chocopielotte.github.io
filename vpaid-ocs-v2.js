!function(e){console.debug("=> preparing the Motionly VPAID object");var i,n={muted:!0},t={},o="AdError";function r(){void 0!==n.realTimeInterval&&(e.clearInterval(n.realTimeInterval),n.realTimeInterval=void 0),void 0!==n.progressInterval&&(e.clearInterval(n.progressInterval),n.progressInterval=void 0),void 0!==n.delegate&&(n.delegate.remove(),n.delegate=void 0),n.playing=!1}function d(e){console.debug("=> received from the player the invocation of the function '"+e+"'")}function a(e){return Math.round(e/1e3*100)/100}function l(e){var i=t[e];if(void 0!==i){for(var n=[],o=1;o<arguments.length;o++)n.push(arguments[o]);console.debug("=> sending to the player the event '"+e+"'");for(var r=0;r<i.length;r++){var d=i[r];d.callback.apply(d.context,n)}}}e.getVPAIDAd=function(){return console.debug("=> creating the Motionly VPAID object"),{handshakeVersion:function(e){return d("handshakeVersion"),console.debug("=> received a handshake with version '"+e+"'"),"2.0"},initAd:function(e,t,r,a,s,p){console.log("environmentVars",p.slot.offsetHeight),d("initAd"),console.debug("=> initializing the ad with dimensions ("+e+"x"+t+") with mode '"+r+"'"),n.containerDimensions={width:Number.isInteger(e)?e:p.slot.offsetWidth,height:Number.isInteger(t)?t:p.slot.offsetHeight},function e(t){try{i=d=JSON.parse(t.AdParameters)}catch(r){return console.error("=> could not parse the 'AdParameters' properly",r),l(o)}var d,a="sdkUrl",s="experiencePosterUrl",p="ratio",u="durationInMilliseconds",c="skipRangeInMilliseconds";return(n.sdkUrl=d[a],"string"!=typeof n.sdkUrl)?(console.error("=> the '"+a+"' parameter with value '"+n.sdkUrl+"' should be a URL"),l(o)):(n.experiencePosterUrl=d[s],"string"!=typeof n.experiencePosterUrl)?(console.error("=> the '"+s+"' parameter with value '"+n.experiencePosterUrl+"' should be a URL"),l(o)):(n.xpRatio=d[p],n.xpRatio<=0)?(console.error("=> the '"+p+"' parameter with value '"+n.xpRatio+"' should be greater than 0"),l(o)):(n.durationInMilliseconds=d[u],n.durationInMilliseconds<=0)?(console.error("=> the '"+u+"' parameter with value '"+n.durationInMilliseconds+"' should not be greater than 0"),l(o)):void(n.skippableRangeInMilliseconds=void 0!==d[c]?d[c]:[0,d.durationInMilliseconds],n.skippableRangeInMilliseconds[0]<0&&(console.warn("=> the '"+c+"' parameter with lower bound value '"+n.skippableRangeInMilliseconds[0]+"' should not be lower than 0"),n.skippableRangeInMilliseconds[0]=0),-1===n.skippableRangeInMilliseconds[1]?n.skippableRangeInMilliseconds[1]=n.durationInMilliseconds:n.skippableRangeInMilliseconds[1]>n.skippableRangeInMilliseconds?(console.warn("=> the '"+c+"' parameter with upper bound value "+n.skippableRangeInMilliseconds[1]+" should not be greater than the '"+u+"'"),n.skippableRangeInMilliseconds[1]=n.durationInMilliseconds):n.skippableRangeInMilliseconds[1]<=n.skippableRangeInMilliseconds[0]&&(console.warn("=> the '"+c+"' parameter with upper bound value "+n.skippableRangeInMilliseconds[1]+" should not be greater than its lower bound value "+n.skippableRangeInMilliseconds[0]),n.skippableRangeInMilliseconds[1]=n.durationInMilliseconds))}(s),n.adSkippableState=!1,n.videoSlot=p.videoSlot;var u,c,g,h,$,m,v,A,f,I,b,M,k,w=p.slot;n.window=w.ownerDocument.defaultView,u=w,c=n.experiencePosterUrl,g=function(){n.videoSlot.src="https://github.com/ChocoPieLotte/chocopielotte.github.io/raw/master/mermaid-trailer.mp4",n.videoSlot.play(),l("AdLoaded")},m=n.containerDimensions,console.log("containerDimensions",m),v=m.width/m.height,console.log("containerRatio",v),A={},v>=n.xpRatio?(h="auto",$="100%",A.width=m.height/n.xpRatio,A.height=m.height):(h="100%",$="100%",A.width=m.width,A.height=m.height),n.xpDimensions=A,console.log("xpDimensions",A),f=document.createElement("img"),n.placeholder=f,(I=f.style).width=h,I.height=$,I.display="block",I.margin="auto",b=function(){return{version:2,overrideDescription:function(e,i){return n.description=i,i},onAction:function(e,i,n){l("AdClickThru",(void 0===n.urlMacro?"":n.urlMacro)+n.url,n.id,!1)},onTechnicalEvent:function(e,i,t){console.log("------------ONTECH EVENT"),"installed"===t&&(i.nodeElement.style.position="absolute",i.nodeElement.style.top="0px",i.nodeElement.style.left="0px",i.videoElement=n,g())}}},M="mtly"+Date.now()+Math.round(1e6*Math.random()),n.window[M]=b,k={callbacks:M,setup:{runMode:"automatic"},experienceId:i.experienceId,dimensions:{buckets:[100,200,300,400,500,600,700,800,900,1e3]},metricsLevel:"none"},f.setAttribute("motionly-params",JSON.stringify(k)),f.setAttribute("id","xp"),f.onerror=function(){return console.error("=> could not load the experience poster"),l(o)},f.src=c,u.appendChild(f),void 0!==n.window.motionly&&n.window.motionly.AutoLoader.load(f),function e(i,t){if(void 0===n.window.motionly){var o=document.createElement("script");o.async=!0,o.onerror=function(){console.error("=> could not load the Motionly engine"),l("onError")},o.src=t,(void 0===i?document.head:i).appendChild(o)}}(w,n.sdkUrl)},startAd:function(){d("startAd");var i=Date.now(),t={startInMilliseconds:i,endInMilliseconds:i+n.durationInMilliseconds,durationInMilliseconds:n.durationInMilliseconds+0,elapsedInMilliseconds:0,remainingInMilliseconds:n.durationInMilliseconds,skippableRangeInMilliseconds:n.skippableRangeInMilliseconds,remainingEvents:["AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete"]};n.timing=t,console.info("=> the ad duration is of "+t.durationInMilliseconds+" ms");var a=1e3/60,s=function(e){var i=t.remainingEvents.indexOf(e);return -1!==i&&(t.remainingEvents.splice(i,1),l(e),!0)};n.realTimeInterval=e.setInterval(function(){!0===n.playing&&(t.elapsedInMilliseconds+=a,t.remainingInMilliseconds=t.durationInMilliseconds-t.elapsedInMilliseconds);var i=t.elapsedInMilliseconds/t.durationInMilliseconds;i>=1?s("AdVideoComplete"):i>=.75?s("AdVideoThirdQuartile"):i>=.5?s("AdVideoMidpoint"):i>=.25?s("AdVideoFirstQuartile"):!0===s("AdVideoStart")&&l("AdImpression");var o=t.elapsedInMilliseconds>=t.skippableRangeInMilliseconds[0]&&t.elapsedInMilliseconds<=t.skippableRangeInMilliseconds[1];o!==n.adSkippableState&&(n.adSkippableState=o,l("AdSkippableStateChange")),i>=1&&!0===n.playing&&(n.playing=!1,e.setTimeout(function(){r(),l("AdStopped")},5*a))},a);var p=n.window.motionly.Initializer.initializer.getHandlerByElement(n.placeholder);if(null===p){l(o);return}if(void 0!==p){n.delegate=p.delegate;try{n.delegate.play()}catch(u){console.error("=> could not play the Motionly experience",u),l(o);return}}n.playing=!0,l("AdStarted")},stopAd:function(){d("stopAd"),r(),l("AdStopped")},skipAd:function(){d("skipAd"),!1!==n.adSkippableState&&(r(),l("AdSkipped"),l("AdStopped"))},resizeAd:function(e,i,n){d("resizeAd"),console.debug("=> asking to resize the ad with dimensions ("+e+"x"+i+") with mode '"+n+"'"),l("AdSizeChange")},pauseAd:function(){d("pauseAd"),void 0!==n.delegate&&n.delegate.pause(),n.playing=!1,l("AdPaused")},resumeAd:function(){d("resumeAd"),void 0!==n.delegate&&n.delegate.play(),n.playing=!0,l("AdPlaying")},expandAd:function(){d("expandAd")},collapseAd:function(){d("collapseAd")},getAdIcons:function(){return d("getAdIcons"),""},getAdCompanions:function(){return d("getAdCompanions"),""},getAdRemainingTime:function(){return d("getAdRemainingTime"),a(n.timing.remainingInMilliseconds)},getAdDuration:function(){return d("getAdDuration"),a(n.timing.durationInMilliseconds)},getAdWidth:function(){return d("getAdWidth"),n.xpDimensions.width},getAdHeight:function(){return d("getAdHeight"),n.xpDimensions.height},getAdLinear:function(){return d("getAdLinear"),!0},getAdSkippableState:function(){return d("getAdSkippableState"),n.adSkippableState},getAdExpanded:function(){return d("getAdExpanded"),!1},getAdVolume:function(){return d("getAdVolume"),!0===n.muted?0:1},setAdVolume:function(e){if(d("setAdVolume"),void 0!==n.delegate){n.muted=0===e;var i=n.delegate.getExperienceContext().properties.videos;if(void 0!==i)for(var t=0;t<i.length;t++)i[t].muted=n.muted}l("AdVolumeChange")},subscribe:function(e,i,n){var o=t[i];void 0===o&&(o=[],t[i]=o),o.push({reference:e,context:n,callback:e})},unsubscribe:function(e,i){var n="string"==typeof i?i:e;console.debug("=> unsubscribing from the event '"+n+"'"),delete t[n]}}}}(window);